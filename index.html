<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FE-like Balance Lab — V4</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!--
  V4: Tous indicateurs + graph utilité (par personnage/classe)
  -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">⚖️</div>
      <div>
        <div class="title">FE-like Balance Lab</div>
        <div class="subtitle">Outil statique offline — V4 (tous indicateurs + graph utilité)</div>
      </div>
    </div>

    <div class="top-actions">
      <label class="pill">
        <input id="toggle-doubling" type="checkbox" />
        <span>Doubling (SPD)</span>
      </label>
      <label class="pill">
        <input id="toggle-crit" type="checkbox" />
        <span>Crit</span>
      </label>
      <div class="sep"></div>
      <div class="hint">
        Astuce: fixe un <b>ennemi standard</b> dans <b>Duels</b> pour un repère stable.
      </div>
    </div>
  </header>

  <main class="container">
    <nav id="tabs" class="tabs">
      <button type="button" class="tab active" data-tab="main">Principal</button>
      <button type="button" class="tab" data-tab="general">Général</button>
      <button type="button" class="tab" data-tab="duels">Duels</button>
      <button type="button" class="tab" data-tab="data">Données</button>
    </nav>

    <section id="tab-main" class="tabpane active">
      <div class="panel">
        <div class="panel-head">
          <h2>Principal — Balance par classe alliée</h2>
          <div class="hint">
            Lecture simple:
            <b>Hit</b>=fiabilité, <b>Dmg attendu</b>=rythme réel, <b>TTK</b>=tempo, <b>TTD</b>=survie.
          </div>
        </div>

        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>Classes alliées</h3>
              <div class="hint">Basé sur les unités <b>player</b> (units[]).</div>
            </div>
            <div id="ally-class-list" class="list"></div>
            <div class="callout mt12">
              Si vide: ajoute une unité player dans Données → units[].
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <div>
                <h3 id="main-class-title">Sélectionne une classe</h3>
                <div class="hint">Les sliders modifient le JSON de travail.</div>
              </div>
              <div class="row gap wrap">
                <button type="button" class="btn small ghost" id="btn-reset-class">Reset classe</button>
              </div>
            </div>

            <div id="main-class-empty" class="badge">Clique une classe à gauche.</div>

            <div id="main-class-panel" class="stack" style="display:none;">
              <div class="grid two">
                <div class="card">
                  <div class="card-head">
                    <h3>Réglages</h3>
                    <div class="hint">Stats + arme de référence.</div>
                  </div>

                  <div class="form-grid">
                    <div>
                      <label class="label">Arme de référence</label>
                      <select id="main-weapon-select" class="input"></select>
                      <div class="hint">Utilisée pour les tableaux et verdicts.</div>
                    </div>

                    <div>
                      <label class="label">Protection arme globale</label>
                      <label class="pill" style="justify-content:flex-start;">
                        <input id="toggle-weapon-clone" type="checkbox" />
                        <span>Dupliquer arme lors du tuning</span>
                      </label>
                      <div class="hint">Évite de casser toutes les unités qui utilisent la même arme.</div>
                    </div>

                    <div>
                      <label class="label">Type de dégâts</label>
                      <div id="main-dmg-type" class="badge">—</div>
                      <div class="hint">Physique=DEF, Magique=MDEF</div>
                    </div>

                    <div>
                      <label class="label">Arme “tuned”</label>
                      <div id="main-weapon-note" class="badge">—</div>
                      <div class="hint">Pour savoir si tu es sur une arme dupliquée.</div>
                    </div>
                  </div>

                  <div class="hr"></div>

                  <div class="hint"><b>Base stats</b></div>
                  <div id="main-stats-sliders" class="stack mt8"></div>

                  <div class="hr"></div>

                  <div class="hint"><b>Arme (sliders)</b></div>
                  <div id="main-weapon-sliders" class="stack mt8"></div>
                </div>

                <div class="card">
                  <div class="card-head">
                    <h3>Indicateurs (vs Standard)</h3>
                    <div class="hint">Rapide (1 cible). Ensuite regarde “vs tous ennemis”.</div>
                  </div>

                  <div id="main-indicators" class="stack"></div>

                  <div class="hr"></div>

                  <div class="card">
                    <div class="card-head">
                      <h3>Alertes “jeu cassé”</h3>
                      <div class="hint">0 dmg, hit &lt; 50%, one-shot, trop long</div>
                    </div>
                    <div id="main-break-alerts" class="stack"></div>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-head">
                  <h3>Graph — utilité globale</h3>
                  <div class="hint">Score visuel (0–100) : dégâts + fiabilité + survie.</div>
                </div>
                <div class="grid two">
                  <div>
                    <canvas id="main-utility-chart" width="520" height="260" class="canvas"></canvas>
                    <div id="main-utility-score" class="row gap wrap mt12"></div>
                  </div>
                  <div>
                    <div class="hint"><b>Comment lire</b></div>
                    <ul class="bullets">
                      <li><b>DPS</b> : expectedDamage, TTK.</li>
                      <li><b>SURVIE</b> : TTD.</li>
                      <li><b>FIABILITÉ</b> : hit moyen + faibles “0 dmg”.</li>
                      <li><b>RISQUE</b> : trop de one-shot.</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-head">
                  <h3>Offense — ta classe attaque TOUS les ennemis</h3>
                  <div class="hint">Pour éviter les réglages “ok vs 1 cible” mais cassés ailleurs.</div>
                </div>

                <div id="main-off-summary" class="row gap wrap"></div>
                <div class="hr"></div>
                <div class="table-wrap">
                  <table class="table" id="main-off-table">
                    <thead>
                      <tr>
                        <th>Ennemi</th>
                        <th>Hit</th>
                        <th>Dmg (hit)</th>
                        <th>Dmg attendu</th>
                        <th>TTK</th>
                        <th>Verdict</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <div class="card">
                <div class="card-head">
                  <h3>Défense — tous les ennemis attaquent ta classe</h3>
                  <div class="hint"><b>TTD</b> = combien de tours tu tiens (approx).</div>
                </div>

                <div id="main-def-summary" class="row gap wrap"></div>
                <div class="hr"></div>
                <div class="table-wrap">
                  <table class="table" id="main-def-table">
                    <thead>
                      <tr>
                        <th>Ennemi</th>
                        <th>Hit</th>
                        <th>Dmg (hit)</th>
                        <th>Dmg entrant attendu</th>
                        <th>TTD</th>
                        <th>Verdict</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <div class="card">
                <div class="card-head">
                  <h3>Tous les indicateurs (pack complet)</h3>
                  <div class="hint">Offense + Défense + variance</div>
                </div>
                <div id="main-all-indicators" class="grid three"></div>
              </div>

              <div class="card">
                <div class="card-head">
                  <h3>Recommandations</h3>
                  <div class="hint">Actions simples basées sur les pires cas.</div>
                </div>
                <div id="main-recos" class="stack"></div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-general" class="tabpane">
      <div class="panel">
        <div class="panel-head">
          <h2>Général — comparaison de toutes les classes alliées</h2>
          <div class="hint">Calcul contre <b>tous les ennemis</b>.</div>
        </div>

        <div id="general-summary" class="row gap wrap"></div>
        <div class="hr"></div>

        <div class="table-wrap">
          <table class="table" id="general-table">
            <thead>
              <tr>
                <th>Classe</th>
                <th>Arme</th>
                <th>Hit moyen</th>
                <th>TTK moyen</th>
                <th>TTD moyen</th>
                <th>0 dmg%</th>
                <th>One-shot%</th>
                <th>Utilité</th>
                <th>Verdict</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="hr"></div>

        <div class="card">
          <div class="card-head">
            <h3>Graph — utilité globale (classe sélectionnée)</h3>
            <div class="hint">Clique une ligne.</div>
          </div>
          <div class="grid two">
            <div>
              <canvas id="general-utility-chart" width="520" height="260" class="canvas"></canvas>
              <div id="general-utility-score" class="row gap wrap mt12"></div>
            </div>
            <div>
              <div id="general-selected" class="badge">Aucune classe sélectionnée.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-duels" class="tabpane">
      <div class="panel">
        <div class="panel-head">
          <h2>Duels</h2>
          <div class="hint">Choisis ton STANDARD ici (Défenseur).</div>
        </div>

        <div class="grid two">
          <div class="card">
            <div class="card-head">
              <h3>Configuration</h3>
            </div>

            <div class="form-grid">
              <div>
                <label class="label">Attaquant</label>
                <select id="duel-attacker" class="input"></select>
              </div>
              <div>
                <label class="label">Terrain attaquant</label>
                <select id="duel-attacker-terrain" class="input"></select>
              </div>
              <div>
                <label class="label">Défenseur (STANDARD)</label>
                <select id="duel-defender" class="input"></select>
              </div>
              <div>
                <label class="label">Terrain défenseur</label>
                <select id="duel-defender-terrain" class="input"></select>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <h3>Résultats</h3>
            </div>
            <div id="duel-results" class="stack"></div>
            <div class="hr"></div>
            <div id="micro-recos" class="stack"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-data" class="tabpane">
      <div class="grid two">
        <div class="panel">
          <div class="panel-head">
            <h2>JSON</h2>
            <div class="row gap wrap">
              <button type="button" class="btn" id="btn-validate">Valider / Parser</button>
              <button type="button" class="btn ghost" id="btn-reset">Reset exemple</button>
              <div class="sep"></div>
              <button type="button" class="btn ghost" id="btn-copy-editor">Copier JSON</button>
              <button type="button" class="btn ghost" id="btn-download-editor">Télécharger JSON</button>
            </div>
          </div>

          <div id="json-status" class="status"></div>
          <textarea id="json-editor" class="textarea" spellcheck="false"></textarea>
        </div>

        <div class="panel">
          <div class="panel-head">
            <h2>Export jeu</h2>
            <div class="row gap wrap">
              <button type="button" class="btn" id="btn-copy-game">Copier export jeu</button>
              <button type="button" class="btn ghost" id="btn-download-game">Télécharger export jeu</button>
            </div>
          </div>

          <pre id="export-preview" class="pre"></pre>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
